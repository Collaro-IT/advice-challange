<!-- @format -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Card Design</title>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500&display=swap" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="./public/stylesheets/main.css" />
    <link rel="stylesheet" href="./public/stylesheets/filtering.css" />	
	
<script>
class CardReader {
    constructor(jsonURL) {
        this.jsonURL = jsonURL;
        this.jsonData = []; // Property to store JSON data
		this.filters = {
            sector: null, // Example filter for sector
            searchText: '', // Example filter for text search
            // Add more filters as needed
        };		
    }

    async fetchData() {
        try {
            // Fetch JSON data
            const response = await fetch(this.jsonURL);
            this.jsonData = await response.json();
        } catch (error) {
            console.error('Error fetching or parsing JSON:', error);
        }
    }

applyFilters() {
    // Apply filters to the data
    let filteredData = this.jsonData;

	if (this.filters.sector && this.filters.sector.length > 0) {
        // Apply sector filter
        filteredData = filteredData.filter(item => this.filters.sector.includes(item.sector.toLowerCase()));
    }

    if (this.filters.searchText) {
        // Apply text search filter to title and description
        const searchText = this.filters.searchText.toLowerCase();
        filteredData = filteredData.filter(item =>
            item.title.toLowerCase().includes(searchText) || item.description.toLowerCase().includes(searchText)
        );
    }
	
	console.log(filteredData);

    // Add more filter conditions as needed

    return filteredData;
}


    loadCards() {
        try {
            // Clear the existing cards in the container
            $('.card-section').empty();

            // Apply filters to get filtered data
            const filteredData = this.applyFilters();

            // Process each item in the filtered data
            let delay = 100; // initial delay
   
            filteredData.forEach(item => {
                
			const card = new Card(item);

			// Append card to the container with a delay

			$('.card-section').append(card.toHTML());
                
            });
			
        } catch (error) {
            console.error('Error loading cards:', error);
        }
    }
}


// Card Object
class Card {
    constructor(item) {

        // Assuming your CSV has headers and data aligns with them
        this.data = item;
    }

    // STRING Gets the colour of the card using sector
    getColor() {
        const sector = this.data.sector.toLowerCase();

        switch (sector) {
            case 'energy':
                return 'teal';
            case 'agriculture':
                return 'green';
            case 'manufacturing':
                return 'orange';
            case 'built environment':
                return 'pink';
            default:
                return 'teal'; // You can choose a default color or handle it as needed
        }
    }

    // STRING Get the Phase Icon
    getPhaseIcon() {
        return this.getColor() + "/" + this.data.phaseTitle.replaceAll(" ", "").replace("&", "") + '.svg';
    }

    // STRING Get AI Icon 1
    getAI1Icon() {
        return this.getColor() + "/" + this.data.ai1.replaceAll(" ", "").replace("&", "") + '.svg';
    }

    // STRING Get AI Icon 2
    getAI2Icon() {
        return this.getColor() + "/" + this.data.ai2.replaceAll(" ", "").replace("&", "") + '.svg';
    }

    // STRING Get AI Icon 3
    getAI3Icon() {
        return this.getColor() + "/" + this.data.ai3.replaceAll(" ", "").replace("&", "") + '.svg';
    }

    // STRING Get Background Image
    getImg() {
        return '/Images/' + this.data.sector + '.svg'
    }

    // BOOL Hide Icon 1 
    hideIcon1() {
        return this.data.ai1 == '' ? true : false;
    }

    // BOOL Hide Icon 2
    hideIcon2() {
        return this.data.ai2 == '' ? true : false;
    }

    // BOOL Hide Icon 3
    hideIcon3() {
        return this.data.ai3 == '' ? true : false;
    }

    // BOOL Hide GC
    hideGC() {
        return this.data.challenge == '' ? true : false;
    }

    // STRING returns HTML for the Star Ratings

    starRating(n) {
        const fillStar = '<img src="./public/assets/Icons/fill-star.svg" alt="fill-star.svg" />';
        const emptyStar = '<img src="./public/assets/Icons/star.svg" alt="star.svg" />';

        switch (n) {
            case 1:
                return `${fillStar} ${emptyStar} ${emptyStar}`;
            case 2:
                return `${fillStar} ${fillStar} ${emptyStar}`;
            case 3:
                return `${fillStar} ${fillStar} ${fillStar}`;
            default:
                return '';
        }
    }


    // Generate HTML for Card

    toHTML() {
        // Convert card data to HTML and return
        return `
      <div class="card fadeIn card-${this.getColor()}-text-bg">
        <div class="card-content">
          <div class="card-side card-${this.getColor()}-bg">
            <div class="control-system card-${this.getColor()}-bg">
			  <div class="number">
				<h5 class="card-${this.getColor()}-text-bg">${this.data.number}</h5>
			  </div>
              <span>${this.data.title}</span>
            </div>
			${!this.hideGC() ? `
            <div class="gc card-${this.getColor()}-bg">
              <h5 class="card-${this.getColor()}-text-bg">${this.data.challenge}</h5>
			</div>` : ''}
            <div class="icon icon-1 card-${this.getColor()}-bg">
              <span><img src="./public/assets/Icons/${this.getPhaseIcon()}" /></span>
            </div>
		    ${!this.hideIcon1() ? `
		      <div class="icon icon-2 card-${this.getColor()}-bg">
			  <span><img src="./public/assets/Icons/${this.getAI1Icon()}" /></span>
		    </div>` : ''}
		    ${!this.hideIcon2() ? `
		      <div class="icon icon-3 card-${this.getColor()}-bg">
			  <span><img src="./public/assets/Icons/${this.getAI2Icon()}" /></span>
		    </div>` : ''}
		    ${!this.hideIcon3() ? `
		      <div class="icon icon-4 card-${this.getColor()}-bg">
			  <span><img src="./public/assets/Icons/${this.getAI3Icon()}" /></span>
		    </div>` : ''}
          </div>

          <div class="card-conent-img">
            <img src="./public/assets/${this.getImg()}" alt="" />
          </div>
          <div class="card-content-text card-${this.getColor()}-text-bg">
            <p>${this.data.description}</p>
            <div class="rating">
              <div class="rating-item card-${this.getColor()}-bg">
                <h6>Impact</h6>
                <div class="rating-icon">
                 ${this.starRating(this.data.Impact)}
                </div>
              </div>
              <div class="rating-item card-${this.getColor()}-bg">
                <h6>AI suitablity</h6>
                <div class="rating-icon">
                 ${this.starRating(this.data.AISuitability)}
                </div>
              </div>
              <div class="rating-item card-${this.getColor()}-bg">
                <h6>Novelty</h6>
                <div class="rating-icon">
                 ${this.starRating(this.data.Novelty)}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>			  
			  
    `;
    }
}

// Launch
$(document).ready(function() {

    const cardReader = new CardReader('data.json');
	cardReader.fetchData().then(() => {
		// Load cards after fetching data
		cardReader.loadCards();
	});
	
	$('#searchBox').on('input', function () {
		cardReader.filters.searchText = $(this).val();
		cardReader.loadCards();
	});
	
	$('.sectorFiler').change(function () {
		// Create an array to store selected sectors
		const selectedSectors = [];

		// Loop through all checkboxes and add selected sectors to the array
		$('.category-page-faceted-search-filter-choice:checked').each(function () {
			selectedSectors.push($(this).val());
		});

		// Update the sector filter in the cardReader with the selected sectors
		cardReader.filters.sector = selectedSectors.length > 0 ? selectedSectors : null;

		console.log(cardReader.filters.sector);

		// Load cards with the updated filters
		cardReader.loadCards();
	});
	

});



</script>
	
	
  </head>
  <body>
  
  
 
<form class="category-page-faceted-search">
  <div class="category-page-faceted-search-element-container category-page-faceted-search-text-container">
    <label class="category-page-faceted-search-label" for="searchBox">Search...</label>
    <input type="text" name="searchBox" id="searchBox" placeholder="" class="category-page-faceted-search-text" />
  </div>
  <!--
  <div class="category-page-faceted-search-element-container category-page-faceted-search-select-container dropdown-container">
    <label class="category-page-faceted-search-label" for="plant_type">Plant Type</label>
    <div class="category-page-faceted-search-select-wrapper dropdown-wrap">
      <input type="text" class="category-page-faceted-search-select-input dropdown" id="plant_type">
      <span class="category-page-faceted-search-select-toggle-arrow dropdown-trigger" aria-hidden="true" data-trigger="plant_type">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true"><path d="M6.984 9.984h10.031L11.999 15z"/></svg>
      </span>
      <div class="category-page-faceted-search-select-list dropdown-list">
        <div class="category-page-faceted-search-select-item dropdown-option">Item 1</div>
        <div class="category-page-faceted-search-select-item dropdown-option">Item 2</div>
        <div class="category-page-faceted-search-select-item dropdown-option">Item 3</div>
        <div class="category-page-faceted-search-select-item dropdown-option">Item 4</div>
        <div class="category-page-faceted-search-select-item dropdown-option">Item 5</div>
        <div class="category-page-faceted-search-select-item dropdown-option">Item 6</div>
      </div>
    </div>
  </div>
  -->
  <fieldset class="category-page-faceted-search-element-container category-page-faceted-search-filter-container">
    <legend class="category-page-faceted-search-label" aria-label="Sunlight Amount">Sector</legend>
    <div class="category-page-faceted-search-filter">
      <input type="checkbox" checked="checked" name="sectorFilter_Energy" id="sectorFilter_Energy" value="energy" class="sectorFiler category-page-faceted-search-filter-choice category-page-faceted-search-filter-choice-1" /> <label for="sectorFilter_Energy" class="category-page-faceted-search-filter-label">
	  Energy
	  </label>
    </div>
    <div class="category-page-faceted-search-filter">
      <input type="checkbox" checked="checked" name="sectorFilter_Manufacturing" id="sectorFilter_Manufacturing" value="manufacturing" class="sectorFiler category-page-faceted-search-filter-choice category-page-faceted-search-filter-choice-2" />
	  <label for="sectorFilter_Manufacturing" class="category-page-faceted-search-filter-label">
	   Manufacturing
      </label>
    </div>
    <div class="category-page-faceted-search-filter category-page-faceted-search-filter-last-row">
      <input type="checkbox" checked="checked" name="sectorFilter_Agriculture" id="sectorFilter_Agriculture" value="agriculture"  class="sectorFiler category-page-faceted-search-filter-choice  category-page-faceted-search-filter-choice-3" />
	  <label for="sectorFilter_Agriculture" class="category-page-faceted-search-filter-label">
	  Agriculture
      </label>
    </div>
    <div class="category-page-faceted-search-filter category-page-faceted-search-filter-last-row">
      <input type="checkbox" checked="checked" name="sectorFilter_BuiltEnvironment" id="sectorFilter_BuiltEnvironment" value="built environment" class="sectorFiler category-page-faceted-search-filter-choice  category-page-faceted-search-filter-choice-4" /> 
	  <label for="sectorFilter_BuiltEnvironment" class="category-page-faceted-search-filter-label">
	  Built Environment
      </label>
    </div>
  </fieldset>
  <div class="category-page-faceted-search-element-container category-page-faceted-search-submit-container">
    <input type="submit" value="Search" class="category-page-faceted-search-submit" />
  </div>
</form> 
  
  <div class="card-section">
  </div>
  
 
  </body>
</html>
